<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>DevEx Admin Dashboard</title>
    <style>
      body {
        font-family: -apple-system, sans-serif;
        background: #f5f5f7;
        padding: 40px;
        color: #1d1d1f;
      }
      .dashboard {
        max-width: 900px;
        margin: 0 auto;
      }
      h1 {
        font-weight: 600;
        margin-bottom: 30px;
      }
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
      }
      .stat-card {
        background: white;
        padding: 24px;
        border-radius: 18px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
      }
      .stat-card h3 {
        margin: 0;
        font-size: 0.9rem;
        color: #86868b;
        text-transform: uppercase;
      }
      .stat-card p {
        margin: 10px 0 0;
        font-size: 2rem;
        font-weight: 600;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 18px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
      }
      th,
      td {
        padding: 16px;
        text-align: left;
        border-bottom: 1px solid #f5f5f7;
      }
      th {
        background: #fafafa;
        font-weight: 600;
        color: #86868b;
      }
      .priority-high {
        color: #ff3b30;
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <div class="dashboard">
      <h1>DevEx Analytics</h1>
      <div class="stats-grid" id="stats-grid"></div>
      <table id="ticket-table">
        <thead>
          <tr>
            <th>Tool</th>
            <th>Issue</th>
            <th>Priority</th>
            <th>Time</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <script>
      async function loadDashboard() {
        const response = await fetch("/admin-data");
        const tickets = await response.json();

        // Calculate Frequencies
        const counts = {};
        tickets.forEach(
          (t) => (counts[t.tool_name] = (counts[t.tool_name] || 0) + 1),
        );

        // Update Stats Grid
        const grid = document.getElementById("stats-grid");
        grid.innerHTML = Object.entries(counts)
          .map(
            ([tool, count]) => `
                <div class="stat-card">
                    <h3>${tool}</h3>
                    <p>${count} Reports</p>
                </div>
            `,
          )
          .join("");

        // Update Table
        const tbody = document.querySelector("#ticket-table tbody");
        tbody.innerHTML = tickets
          .map(
            (t) => `
                <tr>
                    <td><strong>${t.tool_name}</strong></td>
                    <td>${t.issue_description}</td>
                    <td class="priority-${t.priority.toLowerCase()}">${t.priority}</td>
                    <td>${new Date(t.timestamp).toLocaleTimeString()}</td>
                </tr>
            `,
          )
          .join("");
      }
      loadDashboard();
      setInterval(loadDashboard, 5000); // Auto-refresh every 5 seconds
    </script>
  </body>
</html>
